// https://renecutura.eu v0.3.9 Copyright 2021 Rene Cutura
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).druid=t.druid||{})}(this,(function(t){"use strict";function e(t){this.wrapped=t}function r(t){var r,n;function i(r,n){try{var o=t[r](n),s=o.value,h=s instanceof e;Promise.resolve(h?s.wrapped:s).then((function(t){h?i("return"===r?"return":"next",t):a(o.done?"return":"normal",t)}),(function(t){i("throw",t)}))}catch(t){a("throw",t)}}function a(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}(r=r.next)?i(r.key,r.arg):n=null}this._invoke=function(t,e){return new Promise((function(a,o){var s={key:t,arg:e,resolve:a,reject:o,next:null};n?n=n.next=s:(r=n=s,i(t,e))}))},"function"!=typeof t.return&&(this.return=void 0)}function n(t,e,r,n,i,a,o){try{var s=t[a](o),h=s.value}catch(t){return void r(t)}s.done?e(h):Promise.resolve(h).then(n,i)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(i,a){var o=t.apply(e,r);function s(t){n(o,i,a,s,h,"next",t)}function h(t){n(o,i,a,s,h,"throw",t)}s(void 0)}))}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),t}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function _(t,e,r){return(_=l()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&c(i,r.prototype),i}).apply(null,arguments)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?f(t):e}function d(t){var e=l();return function(){var r,n=u(t);if(e){var i=u(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return v(this,r)}}function p(t,e,r,n){return(p="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,r,n){var i,a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(a){if((i=Object.getOwnPropertyDescriptor(a,e)).set)return i.set.call(n,r),!0;if(!i.writable)return!1}if(i=Object.getOwnPropertyDescriptor(n,e)){if(!i.writable)return!1;i.value=r,Object.defineProperty(n,e,i)}else!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(n,e,r);return!0})(t,e,r,n)}function y(t,e,r,n,i){if(!p(t,e,r,n||t)&&i)throw new Error("failed to set property");return r}function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}(t,e)||w(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t){return function(t){if(Array.isArray(t))return k(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||w(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t,e){if(t){if("string"==typeof t)return k(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(t,e):void 0}}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function b(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=w(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function x(t,e){return Math.sqrt(A(t,e))}function M(t){for(var e=t.length,r=0,n=0,i=0;i<e;++i){var a=t[i],o=r+a;Math.abs(r)>=Math.abs(a)?n+=r-o+a:n+=a-o+r,r=o}return r+n}function A(t,e){if(t.length==e.length){for(var r=t.length,n=new Array(r),i=0;i<r;++i){var a=t[i],o=e[i];n[i]=(a-o)*(a-o)}return M(n)}}function j(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x,i=t.shape[0],a=null!=r?r:R(t,n),o=new Array(i),s=function(t){o[t]=Array.from(a.row(t)).map((function(e,r){return{i:t,j:r,distance:e}})).sort((function(t,e){return t.distance-e.distance})).slice(1,e+1)},h=0;h<i;++h)s(h);return o}var z;"function"==typeof Symbol&&Symbol.asyncIterator&&(r.prototype[Symbol.asyncIterator]=function(){return this}),r.prototype.next=function(t){return this._invoke("next",t)},r.prototype.throw=function(t){return this._invoke("throw",t)},r.prototype.return=function(t){return this._invoke("return",t)},z=Symbol.iterator;var N=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(a(this,t),this[z]=this.iterate_rows,this._rows=e,this._cols=r,this._data=null,e&&r){if(!n)return this._data=new Float64Array(e*r),this;if("function"==typeof n){this._data=new Float64Array(e*r);for(var i=0;i<e;++i)for(var o=0;o<r;++o)this._data[i*r+o]=n(i,o);return this}if("string"==typeof n){if("zeros"===n)return new t(e,r,0);if("identity"===n||"I"===n){this._data=new Float64Array(e*r);for(var s=0;s<e;++s)this._data[s*r+s]=1;return this}if("center"===n&&e==r){this._data=new Float64Array(e*r),n=function(t,r){return(t===r?1:0)-1/e};for(var h=0;h<e;++h)for(var u=0;u<r;++u)this._data[h*r+u]=n(h,u);return this}}if("number"==typeof n){this._data=new Float64Array(e*r);for(var c=0;c<e;++c)for(var l=0;l<r;++l)this._data[c*r+l]=n;return this}}return this}return s(t,[{key:"row",value:function(t){var e=this._data,r=this._cols;return e.subarray(t*r,(t+1)*r)}},{key:"iterate_rows",value:regeneratorRuntime.mark((function t(){var e,r,n,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this._cols,r=this._rows,n=this._data,i=0;case 4:if(!(i<r)){t.next=10;break}return t.next=7,n.subarray(i*e,(i+1)*e);case 7:++i,t.next=4;break;case 10:case"end":return t.stop()}}),t,this)}))},{key:"set_row",value:function(e,r){var n=this._cols;if(Array.isArray(r)&&r.length===n)for(var i=e*n,a=0;a<n;++a)this._data[i+a]=r[a];else if(r instanceof t&&r.shape[1]===n&&1===r.shape[0])for(var o=e*n,s=0;s<n;++s)this._data[o+s]=r._data[s];return this}},{key:"col",value:function(t){for(var e=new Float64Array(this._rows),r=0;r<this._rows;++r)e[r]=this._data[r*this._cols+t];return e}},{key:"entry",value:function(t,e){return this._data[t*this._cols+e]}},{key:"set_entry",value:function(t,e,r){return this._data[t*this._cols+e]=r,this}},{key:"transpose",value:function(){var e=this;return new t(this._cols,this._rows,(function(t,r){return e.entry(r,t)}))}},{key:"T",get:function(){return this.transpose()}},{key:"inverse",value:function(){for(var e=this,r=this._rows,n=this._cols,i=new t(r,2*n,(function(t,r){return r>=n?t===r-n?1:0:e.entry(t,r)})),a=0,o=0;a<r&&o<n;){for(var s=0,h=-1/0,u=a;u<r;++u){var c=Math.abs(i.entry(u,o));h<c&&(s=u,h=c)}if(0==i.entry(s,o))o++;else{for(var l=0;l<2*n;++l){var _=i.entry(a,l),f=i.entry(s,l);i.set_entry(a,l,_),i.set_entry(s,l,f)}for(var v=a+1;v<r;++v){var d=i.entry(v,o)/i.entry(a,o);i.set_entry(v,o,0);for(var p=o+1;p<2*n;++p)i.set_entry(v,p,i.entry(v,p)-i.entry(a,p)*d)}a++,o++}}for(var y=0;y<r;++y)for(var m=i.entry(y,y),g=y;g<2*n;++g)i.set_entry(y,g,i.entry(y,g)/m);for(var w=r-1;w>=0;--w)for(var k=i.entry(w,w),b=0;b<w;b++)for(var x=i.entry(b,w)/k,M=b;M<2*n;++M){var A=i.entry(b,M);A-=i.entry(w,M)*x,i.set_entry(b,M,A)}return new t(r,n,(function(t,e){return i.entry(t,e+n)}))}},{key:"dot",value:function(e){var r=this;if(e instanceof t){var n=this;if(n.shape[1]!==e.shape[0])throw"A.dot(B): A is a ".concat(n.shape.join(" x "),"-Matrix, B is a ").concat(e.shape.join(" x "),"-Matrix: \n                A has ").concat(n.shape[1]," cols and B ").concat(e.shape[0]," rows. \n                Must be equal!");var i=n.shape[1];return new t(n.shape[0],e.shape[1],(function(t,r){for(var a=n.row(t),o=e.col(r),s=0,h=0;h<i;++h)s+=a[h]*o[h];return s}))}if(Array.isArray(e)||e instanceof Float64Array){var a=this._rows;if(e.length!==a)throw"A.dot(B): A has ".concat(a," cols and B has ").concat(e.length," rows. Must be equal!");for(var o=new Array(a),s=function(t){o[t]=M(r.row(t).map((function(r){return r*e[t]})))},h=0;h<a;++h)s(h);return o}throw"B must be Matrix or Array"}},{key:"outer",value:function(e){var r=this,n=r._data.length;if(n==e._data.length){var i=new t;return i.shape=[n,n,function(t,n){return t<=n?r._data[t]*e._data[n]:i.entry(n,t)}],i}}},{key:"concat",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"horizontal",n=this,i=m(n.shape,2),a=i[0],o=i[1],s=m(e.shape,2),h=s[0],u=s[1];if("horizontal"==r){if(a!=h)throw'A.concat(B, "horizontal"): A and B need same number of rows, A has '.concat(a," rows, B has ").concat(h," rows.");var c=new t(a,o+u,"zeros");return c.set_block(0,0,n),c.set_block(0,o,e),c}if("vertical"==r){if(o!=u)throw'A.concat(B, "vertical"): A and B need same number of columns, A has '.concat(o," columns, B has ").concat(u," columns.");var l=new t(a+h,o,"zeros");return l.set_block(0,0,n),l.set_block(a,0,e),l}if("diag"==r){var _=new t(a+h,o+u,"zeros");return _.set_block(0,0,n),_.set_block(a,o,e),_}throw'type must be "horizontal" or "vertical", but type is '.concat(r,"!")}},{key:"set_block",value:function(t,e,r){for(var n=m(r.shape,2),i=n[0],a=n[1],o=0;o<i;++o)if(!(o>this._rows))for(var s=0;s<a;++s)s>this._cols||this.set_entry(o+t,s+e,r.entry(o,s));return this}},{key:"get_block",value:function(e,r){var n,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=m(this.shape,2),h=s[0],u=s[1];if(o=null!==(i=o)&&void 0!==i?i:u,(a=null!==(n=a)&&void 0!==n?n:h)<=e||o<=r)throw"\n                end_row must be greater than start_row, and \n                end_col must be greater than start_col, but\n                end_row = ".concat(a,", start_row = ").concat(e,", end_col = ").concat(o,", and start_col = ").concat(r,"!");for(var c=new t(a-e,o-r,"zeros"),l=e,_=0;l<a;++l,++_)for(var f=r,v=0;f<o;++f,++v)c.set_entry(_,v,this.entry(l,f));return c}},{key:"gather",value:function(e,r){for(var n=e.length,i=new t(n,r.length),a=0;a<n;++a)for(var o=e[a],s=0;s<n;++s){var h=r[s];i.set_entry(a,s,this.entry(o,h))}return i}},{key:"_apply_array",value:function(t,e){for(var r=this._data,n=m(this.shape,2),i=n[0],a=n[1],o=0;o<i;++o)for(var s=o*a,h=0;h<a;++h){var u=s+h;r[u]=t(r[u],e(o,h))}return this}},{key:"_apply_rowwise_array",value:function(t,e){return this._apply_array(e,(function(e,r){return t[r]}))}},{key:"_apply_colwise_array",value:function(t,e){for(var r=this._data,n=m(this.shape,2),i=n[0],a=n[1],o=0;o<i;++o)for(var s=o*a,h=0;h<a;++h){var u=s+h;r[u]=e(r[u],t[o])}return this}},{key:"_apply",value:function(e,r){var n=this._data;if(e instanceof t){var i=m(e.shape,2),a=i[0],o=i[1],s=m(this.shape,2),h=s[0],u=s[1];if(1===a){if(u!==o)throw"cols !== value_cols";for(var c=0;c<h;++c)for(var l=0;l<u;++l)n[c*u+l]=r(n[c*u+l],e.entry(0,l))}else if(1===o){if(h!==a)throw"rows !== value_rows";for(var _=0;_<h;++_)for(var f=0;f<u;++f)n[_*u+f]=r(n[_*u+f],e.entry(_,0))}else{if(h!=a||u!=o)throw"error";for(var v=0;v<h;++v)for(var d=0;d<u;++d)n[v*u+d]=r(n[v*u+d],e.entry(v,d))}}else if(Array.isArray(e)){var p=this._rows,y=this._cols;if(e.length===p)for(var g=0;g<p;++g)for(var w=0;w<y;++w)n[g*y+w]=r(n[g*y+w],e[g]);else{if(e.length!==y)throw"error";for(var k=0;k<p;++k)for(var b=0;b<y;++b)n[k*y+b]=r(n[k*y+b],e[b])}}else for(var x=0,M=this._rows*this._cols;x<M;++x)n[x]=r(n[x],e);return this}},{key:"clone",value:function(){var e=new t;return e._rows=this._rows,e._cols=this._cols,e._data=this._data.slice(0),e}},{key:"mult",value:function(t){return this.clone()._apply(t,(function(t,e){return t*e}))}},{key:"divide",value:function(t){return this.clone()._apply(t,(function(t,e){return t/e}))}},{key:"add",value:function(t){return this.clone()._apply(t,(function(t,e){return t+e}))}},{key:"sub",value:function(t){return this.clone()._apply(t,(function(t,e){return t-e}))}},{key:"shape",get:function(){return[this._rows,this._cols]},set:function(t){var e=m(t,3),r=e[0],n=e[1],i=e[2],a=void 0===i?function(){return 0}:i;this._rows=r,this._cols=n,this._data=new Float64Array(r*n);for(var o=0;o<r;++o)for(var s=0;s<n;++s)this._data[o*n+s]=a(o,s);return this}},{key:"to2dArray",get:function(){return g(this.iterate_rows())}},{key:"diag",get:function(){for(var t=this._rows,e=this._cols,r=Math.min(t,e),n=new Float64Array(r),i=0;i<r;++i)n[i]=this.entry(i,i);return n}},{key:"mean",get:function(){return this.sum/(this._rows*this._cols)}},{key:"sum",get:function(){return M(this._data)}},{key:"meanRows",get:function(){for(var t=this._data,e=this._rows,r=this._cols,n=[],i=0;i<e;++i){n[i]=0;for(var a=0;a<r;++a)n[i]+=t[i*r+a];n[i]/=r}return n}},{key:"meanCols",get:function(){for(var t=this._data,e=this._rows,r=this._cols,n=[],i=0;i<r;++i){n[i]=0;for(var a=0;a<e;++a)n[i]+=t[a*r+i];n[i]/=e}return n}}],[{key:"from",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"row";if(e instanceof t)return e.clone();if(!(Array.isArray(e)||e instanceof Float64Array)){if("number"==typeof e)return new t(1,1,e);throw"error"}var n=e.length;if(0===n)throw"Array is empty";if(!(Array.isArray(e[0])||e[0]instanceof Float64Array)){if("row"===r)return new t(1,n,(function(t,r){return e[r]}));if("col"===r)return new t(n,1,(function(t){return e[t]}));if("diag"===r)return new t(n,n,(function(t,r){return t==r?e[t]:0}));throw"1d array has NaN entries"}if(Array.isArray(e[0])||e[0]instanceof Float64Array){for(var i=e[0].length,a=0;a<n;++a)if(e[a].length!==i)throw"various array lengths";return new t(n,i,(function(t,r){return e[t][r]}))}}},{key:"solve_CG",value:function(e,r,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.001,a=e.shape[0],o=r.shape[1],s=new t(a,0),h=0;h<o;++h){var u=t.from(r.col(h)).T,c=new t(a,1,(function(){return n.random})),l=u.sub(e.dot(c)),_=l.clone();do{var f=e.dot(_),v=l.T.dot(l).entry(0,0)/_.T.dot(f).entry(0,0);c=c.add(_.mult(v));var d=l.sub(f.mult(v)),p=d.T.dot(d).entry(0,0)/l.T.dot(l).entry(0,0);_=d.add(_.mult(p)),l=d}while(Math.abs(l.mean)>i);s=s.concat(c,"horizontal")}return s}},{key:"solve",value:function(e,r){for(var n=("L"in e&&"U"in e?e:t.LU(e)),i=n.L,a=n.U,o=i.shape[0],s=r.clone(),h=0;h<o;++h){for(var u=0;u<h-1;++u)s.set_entry(0,h,s.entry(0,h)-i.entry(h,u)*s.entry(1,u));s.set_entry(0,h,s.entry(0,h)/i.entry(h,h))}for(var c=o-1;c>=0;--c){for(var l=o-1;l>c;--l)s.set_entry(0,c,s.entry(0,c)-a.entry(c,l)*s.entry(0,l));s.set_entry(0,c,s.entry(0,c)/a.entry(c,c))}return s}},{key:"LU",value:function(e){for(var r=e.shape[0],n=new t(r,r,"zeros"),i=new t(r,r,"identity"),a=0;a<r;++a){for(var o=a;o<r;++o){for(var s=0,h=0;h<a;++h)s+=n.entry(o,h)*i.entry(h,a);n.set_entry(o,a,e.entry(o,a)-s)}for(var u=a;u<r;++u){if(0===n.entry(a,a))return;for(var c=0,l=0;l<a;++l)c+=n.entry(a,l)*i.entry(l,u);i.set_entry(a,u,(e.entry(a,u)-c)/n.entry(a,a))}}return{L:n,U:i}}},{key:"SVD",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=t.T,n=r.dot(t),i=t.dot(r),a=simultaneous_poweriteration(n,e),o=a.eigenvectors,s=a.eigenvalues,h=simultaneous_poweriteration(i,e),u=h.eigenvectors;return{U:u,Sigma:s.map((function(t){return Math.sqrt(t)})),V:o}}}]),t}();function R(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x,r=t.shape[0],n=new N(r,r),i=0;i<r;++i)for(var a=t.row(i),o=i+1;o<r;++o){var s=e(a,t.row(o));n.set_entry(i,o,s),n.set_entry(o,i,s)}return n}function S(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(r||(r=Math.max(Math.round(e-t)+1,1)),r<2)return 1===r?[t]:[];for(var n=new Array(r),i=r-=1;i>=0;--i)n[i]=(i*e+(r-i)*t)/r;return n}function E(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x,r=null;if(t instanceof N){var n=m(t.shape,2),i=n[0],a=n[1];if(1===i)r=t.row(0);else{if(1!==a)throw"matrix must be 1d!";r=t.col(0)}}else r=t;var o=r.length,s=new Array(o);return s.fill(0),e(r,s)}var O=function(){function t(e){return a(this,t),this._N=624,this._M=397,this._MATRIX_A=2567483615,this._UPPER_MASK=2147483648,this._LOWER_MASK=2147483647,this._mt=new Array(this._N),this._mti=this.N+1,this.seed=e||(new Date).getTime(),this}return s(t,[{key:"seed",get:function(){return this._seed},set:function(t){this._seed=t;var e=this._mt;for(e[0]=t>>>0,this._mti=1;this._mti<this._N;this._mti+=1){var r=this._mti,n=e[r-1]^e[r-1]>>>30;e[r]=(1812433253*((4294901760&n)>>>16)<<16)+1812433253*(65535&n)+r,e[r]>>>=0}}},{key:"random",get:function(){return this.random_int*(1/4294967296)}},{key:"random_int",get:function(){var t,e=new Array(0,this._MATRIX_A);if(this._mti>=this._N){var r;this._mti==this._N+1&&(this.seed=5489);var n=this._N-this._M,i=this._M-this._N;for(r=0;r<n;++r)t=this._mt[r]&this._UPPER_MASK|this._mt[r+1]&this._LOWER_MASK,this._mt[r]=this._mt[r+this._M]^t>>>1^e[1&t];for(;r<this._N-1;++r)t=this._mt[r]&this._UPPER_MASK|this._mt[r+1]&this._LOWER_MASK,this._mt[r]=this._mt[r+i]^t>>>1^e[1&t];t=this._mt[this._N-1]&this._UPPER_MASK|this._mt[0]&this._LOWER_MASK,this._mt[this._N-1]=this._mt[this._M-1]^t>>>1^e[1&t],this._mti=0}return t=this._mt[this._mti+=1],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,(t^=t>>>18)>>>0}},{key:"choice",value:function(t,e){if(t instanceof N){var r=m(t.shape,2),n=r[0];if(r[1],e>n)throw"n bigger than A!";for(var i=new Array(e),a=S(0,n-1),o=0,s=a.length;o<e;++o,--s){var h=this.random_int%s;i[o]=a.splice(h,1)[0]}return i.map((function(e){return t.row(e)}))}if(Array.isArray(t)||t instanceof Float64Array){var u=t.length;if(e>u)throw"n bigger than A!";for(var c=new Array(e),l=S(0,u-1),_=0,f=l.length;_<e;++_,--f){var v=this.random_int%f;c[_]=l.splice(v,1)[0]}return c.map((function(e){return t[e]}))}}}],[{key:"choice",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:19870307,i=m(e.shape,2),a=i[0];if(i[1],r>a)throw"n bigger than A!";for(var o=new t(n),s=new Array(r),h=S(0,a-1),u=0,c=h.length;u<r;++u,--c){var l=o.random_int%c;s[u]=h.splice(l,1)[0]}return s.map((function(t){return e.row(t)}))}}]),t}();function P(t){var e,r,n=b(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;null!=i&&(e<i||void 0===e&&i>=i)&&(e=i)}}catch(t){n.e(t)}finally{n.f()}return e}var Y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"min";return a(this,t),e?t.heapify(e,r,n):(this._accessor=r,this._container=[],this._comparator="min"==n?function(t,e){return t<e}:"max"==n?function(t,e){return t>e}:n,this)}return s(t,[{key:"_swap",value:function(t,e){var r=this._container,n=[r[t],r[e]];r[e]=n[0],r[t]=n[1]}},{key:"_heapify_up",value:function(){for(var t=this._container,e=t.length-1;e>0;){var r=Math.floor((e-1)/2);if(!this._comparator(t[e].value,t[r].value))break;this._swap(r,e),e=r}}},{key:"push",value:function(t){var e={element:t,value:this._accessor(t)};return this._container.push(e),this._heapify_up(),this}},{key:"_heapify_down",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this._container,r=this._comparator,n=e.length,i=2*t+1,a=2*t+2,o=t;if(o>n)throw"index higher than length";i<n&&r(e[i].value,e[o].value)&&(o=i),a<n&&r(e[a].value,e[o].value)&&(o=a),o!==t&&(this._swap(t,o),this._heapify_down(o))}},{key:"pop",value:function(){var t=this._container;if(0===t.length)return null;if(1===t.length)return t.pop();this._swap(0,t.length-1);var e=t.pop();return this._heapify_down(),e}},{key:"first",get:function(){return this._container.length>0?this._container[0]:null}},{key:"iterate",value:regeneratorRuntime.mark((function t(){var e,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=0,r=this._container.length;case 1:if(!(e<r)){t.next=7;break}return t.next=4,this._container[e].element;case 4:++e,t.next=1;break;case 7:case"end":return t.stop()}}),t,this)}))},{key:"toArray",value:function(){var t=this;return this.data().sort((function(e,r){return t._comparator(e,r)?-1:0}))}},{key:"data",value:function(){return this._container.map((function(t){return t.element}))}},{key:"raw_data",value:function(){return this._container}},{key:"length",get:function(){return this._container.length}},{key:"empty",get:function(){return 0===this.length}}],[{key:"heapify",value:function(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"min",a=new t(null,n,i),o=a._container,s=b(e);try{for(s.s();!(r=s.n()).done;){var h=r.value;o.push({element:h,value:n(h)})}}catch(t){s.e(t)}finally{s.f()}for(var u=Math.floor(e.length/2-1);u>=0;--u)a._heapify_down(u);return a}}]),t}(),T=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x;return a(this,t),this._Node=function(){return function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;a(this,t),this.pivot=e,this.child1=r,this.child2=n,this.radius=i}}(),this._Leaf=function(){return function t(e){a(this,t),this.points=e}}(),this._metric=r,e&&this.add(e),this}return s(t,[{key:"add",value:function(t){return t=t.map((function(t,e){return{index:e,element:t}})),this._root=this._construct(t),this}},{key:"_construct",value:function(t){var e=this;if(1===t.length)return new this._Leaf(t);var r=this._greatest_spread(t),n=t.sort((function(t,e){return t.element[r]-e.element[r]})),i=n.length,a=Math.floor(i/2),o=t[a],s=n.slice(0,a),h=n.slice(a,i),u=Math.max.apply(Math,g(t.map((function(t){return e._metric(o.element,t.element)}))));return s.length>0&&h.length>0?new this._Node(o,this._construct(s),this._construct(h),u):new this._Leaf(t)}},{key:"_greatest_spread",value:function(t){for(var e=t[0].element.length,r=new Array(e),n=0;n<e;++n)r[n]=[1/0,-1/0];var i=t.reduce((function(t,r){for(var n=0;n<e;++n)t[n][0]=Math.min(t[n][0],r.element[n]),t[n][1]=Math.max(t[n][1],r.element[n]);return t}),r);i=i.map((function(t){return t[1]-t[0]}));for(var a=0,o=0;o<e;++o)a=i[o]>i[a]?o:a;return a}},{key:"search",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return this._search(t,r,new Y(null,(function(r){return e._metric(r.element,t)}),"max"),this._root)}},{key:"_search",value:function(t,e,r,n){if(r.length>=e&&n.pivot&&n.radius&&this._metric(t,n.pivot.element)-n.radius>=r.first.value)return r;if(n.child1&&this._search(t,e,r,n.child1),n.child2&&this._search(t,e,r,n.child2),n.points)for(var i=0,a=n.points.length;i<a;++i){var o=n.points[i];e>r.length?r.push(o):(r.push(o),r.pop())}return r}}]),t}();function F(t){for(var e=m(t.shape,2),r=e[0],n=e[1],i=new N(r,n,"identity"),a=new N(n,n,0),o=function(e){for(var n=t.col(e),o=function(t){var r=i.col(t),o=M(r.map((function(t,e){return t*n[e]})));a.set_entry(t,e,o),n=n.map((function(t,e){return t-o*r[e]}))},s=0;s<e;++s)o(s);for(var h=E(n,x),u=0;u<r;++u)i.set_entry(u,e,n[u]/h);a.set_entry(e,e,h)},s=0;s<n;++s)o(s);return{R:a,Q:i}}function D(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1212,i=n instanceof O?n:new O(n);t instanceof N||(t=N.from(t));for(var a=t.shape[0],o=F(new N(a,e,(function(){return i.random}))),s=o.Q,h=o.R;r--;){var u=h.clone(),c=t.dot(s),l=F(c);s=l.Q,M((h=l.R).sub(u).diag)/a<1e-12&&(r=0)}var _=h.diag,f=s.transpose().to2dArray;return{eigenvalues:_,eigenvectors:f}}var L=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1212;if(a(this,t),Array.isArray(e))this._type="array",this.X=N.from(e);else{if(!(e instanceof N))throw"no valid type for X";this._type="matrix",this.X=e}var o=m(this.X.shape,2);return this._N=o[0],this._D=o[1],this._d=r,this._metric=n,this._seed=i,this._randomizer=new O(i),this._is_initialized=!1,this}var e,r;return s(t,[{key:"parameter_list",get:function(){return this._parameter_list},set:function(t){return this._parameter_list=t,this}},{key:"parameter",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(-1===this.parameter_list.findIndex((function(e){return e===t})))throw"".concat(t," is not a valid parameter!");return e?(this["_".concat(t)]=e,this):this["_".concat(t)]}},{key:"para",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.parameter(t,e)}},{key:"p",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.parameter(t,e)}},{key:"transform",value:function(){return this.check_init(),this.Y}},{key:"generator",value:function(){return this.transform()}},{key:"check_init",value:function(){this._is_initialized||"function"!=typeof this.init||(this.init(),this._is_initialized=!0)}},{key:"projection",get:function(){return"matrix"===this._type?this.Y:this.Y.to2dArray}},{key:"transform_async",value:(r=i(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.transform());case 1:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})}],[{key:"transform",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=_(this,e);return n.transform()}},{key:"transform_async",value:(e=i(regeneratorRuntime.mark((function t(){var e=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.transform.apply(this,e));case 1:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"generator",value:regeneratorRuntime.mark((function t(){var e,r,n,i,a,o,s,h,u=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(e=u.length,r=new Array(e),n=0;n<e;n++)r[n]=u[n];i=_(this,r),a=i.generator(),o=b(a),t.prev=4,o.s();case 6:if((s=o.n()).done){t.next=12;break}return h=s.value,t.next=10,h;case 10:t.next=6;break;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(4),o.e(t.t0);case 17:return t.prev=17,o.f(),t.finish(17);case 20:case"end":return t.stop()}}),t,this,[[4,14,17,20]])}))}]),t}(),I=function(t){h(r,t);var e=d(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return a(this,r),v(n=e.call(this,t,i),f(n))}return s(r,[{key:"transform",value:function(){var t=this.X,e=t.shape[1],r=new N(e,e,"center"),n=t.dot(r),i=D(n.transpose().dot(n),this._d).eigenvectors;return i=N.from(i).transpose(),this.Y=t.dot(i),this.projection}}]),r}(L),B=function(t){h(r,t);var e=d(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1212;return a(this,r),v(n=e.call(this,t,i,o,s),f(n))}return s(r,[{key:"transform",value:function(){var t=this.X,e=t.shape[0],r=this._metric,n=new Float64Array(e),i=new Float64Array(e),a=0,o=new N;o.shape=[e,e,function(e,s){if(e===s)return 0;var h=e<s?r(t.row(e),t.row(s)):o.entry(s,e);return n[e]+=h,i[s]+=h,a+=h,h}],this._d_X=o,n=n.map((function(t){return t/e})),i=i.map((function(t){return t/e})),a/=Math.pow(e,2);var s=D(new N(e,e,(function(t,e){return o.entry(t,e)-n[t]-i[e]+a})),this._d).eigenvectors;return this.Y=N.from(s).transpose(),this.projection}},{key:"stress",get:function(){var t=this.X.shape[0],e=this.Y,r=this._d_X,n=new N;n.shape=[t,t,function(t,r){return t<r?x(e.row(t),e.row(r)):n.entry(r,t)}];for(var i=0,a=0,o=0;o<t;++o)for(var s=o+1;s<t;++s)i+=Math.pow(r.entry(o,s)-n.entry(o,s),2),a+=Math.pow(r.entry(o,s),2);return Math.sqrt(i/a)}}]),r}(L),K=function(t){h(r,t);var e=d(r);function r(t,n){var i,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1212;return a(this,r),y((i=f(o=e.call(this,t,s,h,c)),u(r.prototype)),"parameter_list",["k"],i,!0),o.parameter("k",Math.min(null!=n?n:Math.max(Math.floor(o.X.shape[0]/10),2),o._N-1)),v(o,f(o))}return s(r,[{key:"transform",value:function(){this.check_init();var t=this.X,e=this._N,r=this._metric,n=new N;n.shape=[e,e,function(e,i){return e<=i?r(t.row(e),t.row(i)):n.entry(i,e)}];for(var i=[],a=0;a<e;++a){for(var o=[],s=0;s<e;++s)o.push({index:s,distance:n.entry(a,s)});var h=new Y(o,(function(t){return t.distance}),"min");i.push(h.toArray().slice(1,this._k+1))}for(var u=new N(e,e,(function(t,e){var r=i[t].find((function(t){return t.index===e}));return r?r.distance:1/0})),c=0;c<e;++c)for(var l=0;l<e;++l)for(var _=0;_<e;++_)u.set_entry(c,l,Math.min(u.entry(c,l),u.entry(c,_)+u.entry(_,l)));var f=new Float64Array(e),v=new Float64Array(e),d=0,p=new N(e,e,(function(t,e){var r=u.entry(t,e);return r=r===1/0?0:r,f[t]+=r,v[e]+=r,d+=r,r}));f=f.map((function(t){return t/e})),v=v.map((function(t){return t/e})),d/=Math.pow(e,2);var y=D(new N(e,e,(function(t,e){return p.entry(t,e)-f[t]-v[e]+d})),this._d).eigenvectors;return this.Y=N.from(y).transpose(),this.projection}}]),r}(L),q=function(t){h(r,t);var e=d(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1212;return a(this,r),v(n=e.call(this,t,i,o,s),f(n))}return s(r,[{key:"_choose_distant_objects",value:function(t){for(var e=this.X.shape[0],r=this._randomizer.random_int%e-1,n=null,i=-1/0,a=0;a<e;++a){var o=t(r,a);o>i&&(i=o,n=a)}i=-1/0;for(var s=0;s<e;++s){var h=t(n,s);h>i&&(i=h,r=s)}return[r,n,i]}},{key:"transform",value:function(){for(var t=this,e=this.X,r=e.shape[0],n=this._d,i=this._metric,a=new N(r,n,0),o=function(t,r){return i(e.row(t),e.row(r))},s=function(e){var n=o,i=m(t._choose_distant_objects(o),3),s=i[0],h=i[1],u=i[2];if(0!==u){for(var c=0;c<r;++c){var l=o(s,c),_=o(h,c),f=(Math.pow(l,2)+Math.pow(u,2)-Math.pow(_,2))/(2*u);a.set_entry(c,e,f)}o=function(t,r){return Math.sqrt(Math.pow(n(t,r),2)-Math.pow(a.entry(t,e)-a.entry(r,e),2))}}},h=0;h<n;++h)s(h);return this.Y=a,this.projection}}]),r}(L),C=function(t){h(r,t);var e=d(r);function r(t,n){var i,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1212;return a(this,r),y((i=f(o=e.call(this,t,s,h,c)),u(r.prototype)),"parameter_list",["labels"],i,!0),o.parameter("labels",n),v(o,f(o))}return s(r,[{key:"transform",value:function(){var t=this.X,e=m(t.shape,2);e[0];var r=e[1],n=this._labels,i={},a=0;n.forEach((function(e,r){e in i?(i[e].count++,i[e].rows.push(t.row(r))):i[e]={id:a++,count:1,rows:[t.row(r)]}}));var o=t.mean,s=new N(a,r);for(var h in i)for(var u=N.from(i[h].rows).meanCols,c=0;c<r;++c)s.set_entry(i[h].id,c,u[c]);var l=new N(r,r),_=function(t){var e=s.row(i[t].id),n=new N(r,1,(function(t){return e[t]-o})),a=i[t].count;l=l.add(n.dot(n.transpose()).mult(a))};for(var f in i)_(f);var v=new N(r,r),d=function(t){for(var e=s.row(i[t].id),n=new N(r,1,(function(t){return e[t]})),a=i[t].rows,o=function(t,e){var i=new N(r,1,(function(e,r){return a[t][e]-n.entry(e,0)}));v=v.add(i.dot(i.transpose()))},h=0,u=i[t].count;h<u;++h)o(h)};for(var p in i)d(p);var y=D(v.inverse().dot(l),this._d).eigenvectors;return y=N.from(y).transpose(),this.Y=t.dot(y),this.projection}}]),r}(L),U=function(t){h(r,t);var e=d(r);function r(t,n){var i,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1212;return a(this,r),y((i=f(o=e.call(this,t,s,h,c)),u(r.prototype)),"parameter_list",["k"],i,!0),o.parameter("k",Math.min(null!=n?n:Math.max(Math.floor(o._N/10),2),o._N-1)),v(o,f(o))}return s(r,[{key:"transform",value:function(){for(var t=this,e=this.X,r=this._d,n=this._N,i=this._D,a=this.parameter("k"),o=j(e,a,null,this._metric),s=new N(a,1,1),h=new N(n,n),u=function(r){var n=o[r],u=new N(a,i,(function(t,i){return e.entry(n[t].j,i)-e.entry(r,i)})),c=u.dot(u.T);if(a>i)for(var l=M(c.diag)/1e3,_=0;_<a;++_)c.set_entry(_,_,c.entry(_,_)+l);var f=N.solve_CG(c,s,t._randomizer);f=f.divide(f.sum);for(var v=0;v<a;++v)h.set_entry(r,n[v].j,f.entry(v,0))},c=0;c<n;++c)u(c);var l=new N(n,n,"identity").sub(h),_=D(l.T.dot(l).T.inverse(),r+1).eigenvectors;return this.Y=N.from(_.slice(1,1+r)).T,this.projection}}]),r}(L),W=function(t){h(r,t);var e=d(r);function r(t,n){var i,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1212;if(a(this,r),y((i=f(o=e.call(this,t,s,h,c)),u(r.prototype)),"parameter_list",["k"],i,!0),o.parameter("k",Math.min(null!=n?n:Math.max(Math.floor(o._N/10),2),o._N-1)),o._D<=s)throw"Dimensionality of X (D = ".concat(o._D,") must be greater than the required dimensionality of the result (d = ").concat(s,")!");return v(o,f(o))}return s(r,[{key:"transform",value:function(){for(var t=this.X,e=this._d,r=m(t.shape,2),n=r[0],i=r[1],a=this.parameter("k"),o=j(t,a,null,this._metric),s=new N(i,i,"center"),h=new N(n,n,0),u=0;u<n;++u)for(var c=[u].concat(g(o[u].map((function(t){return t.j})))),l=N.from(c.map((function(e){return t.row(e)}))),_=D((l=l.dot(s)).dot(l.transpose()),e).eigenvectors,f=N.from(_),v=f.transpose().dot(f).add(1/Math.sqrt(a+1)),d=0;d<a+1;++d)for(var p=0;p<a+1;++p)h.set_entry(c[d],c[p],h.entry(c[d],c[p])-(d===p?1:0)+v.entry(d,p));var y=D(h,e+1).eigenvectors;return this.Y=N.from(y.slice(1)).transpose(),this.projection}}]),r}(L),G=function(t){h(r,t);var e=d(r);function r(t){var n,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:x,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1212;a(this,r),y((n=f(i=e.call(this,t,h,c,l)),u(r.prototype)),"parameter_list",["perplexity","epsilon"],n,!0);var _=m(i.X.shape,2);return i._N=_[0],i._D=_[1],i.parameter("perplexity",Math.min(o,i._N-1)),i.parameter("epsilon",s),i._iter=0,i.Y=new N(i._N,i._d,(function(){return i._randomizer.random})),v(i,f(i))}return s(r,[{key:"init",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=Math.log(this._perplexity),n=this._N,i=this._D,a=this._metric,o=this.X;if(e)t=e;else{t=new N(n,n);for(var s=0;s<n;++s)for(var h=o.row(s),u=s+1;u<n;++u){var c=a(h,o.row(u));t.set_entry(s,u,c),t.set_entry(u,s,c)}}var l=new N(n,n,"zeros");this._ystep=new N(n,i,"zeros"),this._gains=new N(n,i,1);for(var _=new Array(n).fill(0),f=1e-4,v=50,d=0;d<n;++d){for(var p=-1/0,y=1/0,m=1,g=!1,w=0;!g;){for(var k=0,b=0;b<n;++b){var x=Math.exp(-t.entry(d,b)*m);d===b&&(x=0),_[b]=x,k+=x}for(var M=0,A=0;A<n;++A){var j=0===k?0:_[A]/k;_[A]=j,j>1e-7&&(M-=j*Math.log(j))}M>r?(p=m,m=y===1/0?2*m:(m+y)/2):(y=m,m=p===-1/0?m/2:(m+p)/2),++w,Math.abs(M-r)<f&&(g=!0),w>=v&&(g=!0)}for(var z=0;z<n;++z)l.set_entry(d,z,_[z])}for(var R=new N(n,n,"zeros"),S=2*n,E=0;E<n;++E)for(var O=E;O<n;++O){var X=Math.max((l.entry(E,O)+l.entry(O,E))/S,1e-100);R.set_entry(E,O,X),R.set_entry(O,E,X)}return this._P=R,this}},{key:"transform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;this.check_init();for(var e=0;e<t;++e)this.next();return this.projection}},{key:"generator",value:regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.check_init();case 1:return this.next(),t.next=5,this.projection;case 5:t.next=1;break;case 7:case"end":return t.stop()}}),t,this)}))},{key:"next",value:function(){for(var t=++this._iter,e=this._P,r=this._ystep,n=this._gains,i=this._N,a=this._epsilon,o=this._d,s=this.Y,h=t<100?4:1,u=new N(i,i,"zeros"),c=0,l=0;l<i;++l)for(var _=l+1;_<i;++_){for(var f=0,v=0;v<o;++v){var d=s.entry(l,v)-s.entry(_,v);f+=d*d}var p=1/(1+f);u.set_entry(l,_,p),u.set_entry(_,l,p),c+=2*p}for(var y=new N(i,i,0),m=0;m<i;++m)for(var g=m+1;g<i;++g){var w=Math.max(u.entry(m,g)/c,1e-100);y.set_entry(m,g,w),y.set_entry(g,m,w)}for(var k=new N(i,o,"zeros"),b=0;b<i;++b)for(var x=0;x<i;++x)for(var M=4*(h*e.entry(b,x)-y.entry(b,x))*u.entry(b,x),A=0;A<o;++A)k.set_entry(b,A,k.entry(b,A)+M*(s.entry(b,A)-s.entry(x,A)));for(var j=new Float64Array(o),z=0;z<i;++z)for(var R=0;R<o;++R){var S=k.entry(z,R),E=r.entry(z,R),O=n.entry(z,R),X=Math.sign(S)===Math.sign(E)?.8*O:O+.2;X<.01&&(X=.01),n.set_entry(z,R,X);var P=(t<250?.5:.8)*E-a*X*S;r.set_entry(z,R,P),s.set_entry(z,R,s.entry(z,R)+P),j[R]+=s.entry(z,R)}for(var Y=0;Y<i;++Y)for(var T=0;T<2;++T)s.set_entry(Y,T,s.entry(Y,T)-j[T]/i);return this.Y}}]),r}(L);function Q(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,n=.01,i=e.length,a=.001,o=1e4,s=e.slice(),h=t(s),u=!1;r-- >=0&&!u;){u=!0;for(var c=0;c<i;++c){s[c]+=1e-6;var l=t(s);s[c]-=1e-6;var _=(l-h)/1e-6;Math.abs(_)>n&&(u=!1),s[c]-=a*_,h=t(s)}a*=o>=h?1.05:.4,o=h}return s}var H=function(t){h(r,t);var e=d(r);function r(t){var n,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:x,_=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1212;a(this,r),y((n=f(i=e.call(this,t,c,l,_)),u(r.prototype)),"parameter_list",["n_neighbors","local_connectivity","min_dist"],n,!0);var d=m(i.X.shape,2);return i._N=d[0],i._D=d[1],o=Math.min(i._N-1,o),i.parameter("n_neighbors",o),i.parameter("local_connectivity",Math.min(s,o-1)),i.parameter("min_dist",h),i._iter=0,i._spread=1,i._set_op_mix_ratio=1,i._repulsion_strength=1,i._negative_sample_rate=5,i._n_epochs=350,i._initial_alpha=1,i.Y=new N(i._N,i._d,(function(){return i._randomizer.random})),v(i,f(i))}return s(r,[{key:"_find_ab_params",value:function(t,e){for(var r=S(0,3*t,300),n=S(0,3*t,300),i=0,a=r.length;i<a;++i){var o=r[i];n[i]=o<e?1:Math.exp(-(o-e)/t)}return Q((function(t){var e=S(1,300).map((function(e,i){return n[i]-(a=r[i],o=t[0],s=t[1],1/(1+o*Math.pow(a,2*s)));var a,o,s}));return Math.sqrt(M(e.map((function(t){return t*t}))))}),[1,1])}},{key:"_compute_membership_strengths",value:function(t,e,r){for(var n=0,i=t.length;n<i;++n)for(var a=0,o=t[n].length;a<o;++a){var s=t[n][a].value-r[n];t[n][a].value=s>0?Math.exp(-s/e[n]):1}return t}},{key:"_smooth_knn_dist",value:function(t,e){for(var r=1e-5,n=.001,i=this._local_connectivity,a=Math.log2(e),o=[],s=[],h=this.X,u=g(h).map((function(r){return t.search(r,e).raw_data().reverse()})),c=0,l=h.shape[0];c<l;++c){var _=0,f=1/0,v=1,d=u[c],p=d.filter((function(t){return t.value>0})),y=p.length;if(y>=i){var m=Math.floor(i),w=i-m;m>0?(o.push(p[m-1]),w>r&&(o[c].value+=w*(p[m].value-p[m-1]))):o[c].value=w*p[0].value}else y>0&&(o[c]=p[y-1].value);for(var k=0;k<64;++k){for(var b=0,x=0;x<e;++x){var M=d[x].value-o[c];b+=M>0?Math.exp(-M/v):1}if(Math.abs(b-a)<r)break;if(b>a){var A=[v,(_+f)/2];f=A[0],v=A[1]}else if(f===1/0){var j=[v,2*v];_=j[0],v=j[1]}else{var z=[v,(_+f)/2];_=z[0],v=z[1]}}s[c]=v;var N=d.reduce((function(t,e){return t+e.value}),0)/d.length;if(o[c]>0)s[c]<n*N&&(s[c]=n*N);else{var R=u.reduce((function(t,e){return t+e.reduce((function(t,e){return t+e.value}),0)/e.length}));s[c]>n*R&&(s[c]=n*R)}}return{distances:u,sigmas:s,rhos:o}}},{key:"_fuzzy_simplicial_set",value:function(t,e){var r=t.shape[0],n=new T(t.to2dArray,x),i=this._smooth_knn_dist(n,e),a=i.distances,o=i.sigmas,s=i.rhos;a=this._compute_membership_strengths(a,o,s);for(var h=new N(r,r,"zeros"),u=0;u<r;++u)for(var c=a[u],l=0;l<c.length;++l)h.set_entry(u,c[l].element.index,c[l].value);var _=h.T,f=h.mult(_);return h.add(_).sub(f).mult(this._set_op_mix_ratio).add(f.mult(1-this._set_op_mix_ratio))}},{key:"_make_epochs_per_sample",value:function(t){for(var e=this._weights,r=new Float32Array(e.length).fill(-1),n=P(e),i=e.map((function(e){return t*(e/n)})),a=0;a<r.length;++a)i[a]>0&&(r[a]=Math.round(t/i[a]));return r}},{key:"_tocoo",value:function(t){for(var e=[],r=[],n=[],i=m(t.shape,2),a=i[0],o=i[1],s=0;s<a;++s)for(var h=0;h<o;++h){var u=t.entry(s,h);0!==u&&(e.push(s),r.push(h),n.push(u))}return{rows:e,cols:r,data:n}}},{key:"init",value:function(){var t=this,e=m(this._find_ab_params(this._spread,this._min_dist),2),r=e[0],n=e[1];this._a=r,this._b=n,this._graph=this._fuzzy_simplicial_set(this.X,this._n_neighbors);var i=this._tocoo(this._graph),a=i.rows,o=i.cols,s=i.data;return this._head=a,this._tail=o,this._weights=s,this._epochs_per_sample=this._make_epochs_per_sample(this._n_epochs),this._epochs_per_negative_sample=this._epochs_per_sample.map((function(e){return e*t._negative_sample_rate})),this._epoch_of_next_sample=this._epochs_per_sample.slice(),this._epoch_of_next_negative_sample=this._epochs_per_negative_sample.slice(),this}},{key:"local_connectivity",get:function(){return this._local_connectivity},set:function(t){this._local_connectivity=t}},{key:"min_dist",get:function(){return this._min_dist},set:function(t){this._min_dist=t}},{key:"graph",value:function(){return this.check_init(),{cols:this._head,rows:this._tail,weights:this._weights}}},{key:"transform",value:function(t){this.check_init(),t=t||this._n_epochs;for(var e=0;e<t;++e)this.next();return this.projection}},{key:"generator",value:regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.check_init(),this._iter=0;case 2:if(!(this._iter<this._n_epochs)){t.next=8;break}return this.next(),t.next=6,this.projection;case 6:t.next=2;break;case 8:return t.abrupt("return",this.projection);case 9:case"end":return t.stop()}}),t,this)}))},{key:"_clip",value:function(t){return t>4?4:t<-4?-4:t}},{key:"_optimize_layout",value:function(t,e,r,n){for(var i=this._d,a=this._alpha,o=this._repulsion_strength,s=this._a,h=this._b,u=this._epochs_per_sample,c=this._epochs_per_negative_sample,l=this._epoch_of_next_negative_sample,_=this._epoch_of_next_sample,f=this._clip,v=n.length,d=0,p=u.length;d<p;++d)if(_[d]<=this._iter){var y=r[d],m=n[d],g=t.row(y),w=e.row(m),k=A(g,w),b=0;k>0&&(b=-2*s*h*Math.pow(k,h-1)/(s*Math.pow(k,h)+1));for(var x=0;x<i;++x){var M=f(b*(g[x]-w[x]))*a,j=g[x]+M,z=w[x]-M;g[x]=j,w[x]=z,t.set_entry(y,x,j),e.set_entry(m,x,z)}_[d]+=u[d];for(var N=(this._iter-l[d])/c[d],R=0;R<N;++R){var S=Math.floor(this._randomizer.random*v),E=e.row(n[S]),O=A(g,E),X=0;if(O>0)X=2*o*h/((.01+O)*(s*Math.pow(O,h)+1));else if(y===S)continue;for(var P=0;P<i;++P){var Y=f(X*(g[P]-E[P]))*a,T=g[P]+Y,F=E[P]-Y;g[P]=T,E[P]=F,t.set_entry(y,P,T),e.set_entry(n[S],P,F)}}l[d]+=N*c[d]}return t}},{key:"next",value:function(){var t=++this._iter,e=this.Y;return this._alpha=this._initial_alpha*(1-t/this._n_epochs),this.Y=this._optimize_layout(e,e,this._head,this._tail),this.Y}}]),r}(L),V=function(t){h(r,t);var e=d(r);function r(t){var n,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:x,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1212;return a(this,r),y((n=f(i=e.call(this,t,h,c,l)),u(r.prototype)),"parameter_list",["weight_adj","c"],n,!0),i.parameter("weight_adj",o),i.parameter("c",s),v(i,f(i))}return s(r,[{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.X,n=r.shape[0],i=this._d,a=this._metric,o=this._c;this.n_inliers=2*o,this.n_outliers=1*o,this.n_random=1*o,this.Y=t||new I(r,i).transform(),this.knn=e||new T(r.to2dArray,a);var s=this._generate_triplets(this.n_inliers,this.n_outliers,this.n_random),h=s.triplets,u=s.weights;return this.triplets=h,this.weights=u,this.lr=1e3*n/h.shape[0],this.C=1/0,this.tol=1e-7,this.vel=new N(n,i,0),this.gain=new N(n,i,1),this}},{key:"_generate_triplets",value:function(t,e,r){for(var n=this._metric,i=this._weight_adj,a=this.X,o=a.shape[0],s=this.knn,h=Math.min(t+20,o),u=new N(o,h),c=new N(o,h),l=function(t){s.search(a.row(t),h+1).raw_data().filter((function(t){return 0!=t.value})).sort((function(t,e){return t.value-e.value})).forEach((function(e,r){u.set_entry(t,r,e.element.index),c.set_entry(t,r,e.value)}))},_=0;_<o;++_)l(_);for(var f=new Float64Array(o),v=0;v<o;++v)f[v]=Math.max((c.entry(v,3)+c.entry(v,4)+c.entry(v,5)+c.entry(v,6))/4,1e-10);for(var d=this._find_p(c,f,u),p=this._sample_knn_triplets(d,u,t,e),y=p.shape[0],m=new Float64Array(y),w=0;w<y;++w){var k=p.entry(w,0),b=p.entry(w,2);m[w]=n(a.row(k),a.row(b))}var x=this._find_weights(p,d,u,m,f);if(r>0){var M=this._sample_random_triplets(a,r,f),A=M.random_triplets,j=M.random_weights;p=p.concat(A,"vertical"),x=Float64Array.from([].concat(g(x),g(j)))}y=p.shape[0];for(var z=-1/0,R=0;R<y;++R)isNaN(x[R])&&(x[R]=0),z<x[R]&&(z=x[R]);for(var S=-1/0,E=0;E<y;++E)x[E]/=z,x[E]+=1e-4,x[E]=Math.log(1+i*x[E]),S<x[E]&&(S=x[E]);for(var O=0;O<y;++O)x[O]/=S;return{triplets:p,weights:x}}},{key:"_find_p",value:function(t,e,r){var n=m(t.shape,2),i=n[0],a=n[1];return new N(i,a,(function(n,i){return Math.exp(-Math.pow(t.entry(n,i),2)/e[n]/e[r.entry(n,i)])}))}},{key:"_sample_knn_triplets",value:function(t,e,r,n){for(var i=e.shape[0],a=new N(i*r*n,3),o=0;o<i;++o)for(var s=o*r*n,h=this.__argsort(t.row(o).map((function(t){return-t}))),u=0;u<r;++u)for(var c=u*n,l=e.entry(o,h[u]),_=this._rejection_sample(n,i,h.slice(0,u+1)),f=0;f<n;++f){var v=s+c+f,d=_[f];a.set_entry(v,0,o),a.set_entry(v,1,l),a.set_entry(v,2,d)}return a}},{key:"__argsort",value:function(t){return t.map((function(t,e){return{d:t,i:e}})).sort((function(t,e){return t.d-e.d})).map((function(t){return t.i}))}},{key:"_rejection_sample",value:function(t,e,r){var n=this._randomizer,i=S(0,e-1).filter((function(t){return r.indexOf(t)<0}));return n.choice(i,Math.min(t,i.length-2))}},{key:"_find_weights",value:function(t,e,r,n,i){for(var a=t.shape[0],o=new Float64Array(a),s=0;s<a;++s){var h=t.entry(s,0),u=r.row(h).indexOf(t.entry(s,1)),c=e.entry(h,u),l=Math.exp(-Math.pow(n[s],2)/(i[h]*i[t.entry(s,2)]));l<1e-20&&(l=1e-20),o[s]=c/l}return o}},{key:"_sample_random_triplets",value:function(t,e,r){for(var n=this._metric,i=this._randomizer,a=t.shape[0],o=new N(a*e,3),s=new Float64Array(a*e),h=0;h<a;++h)for(var u=h*e,c=[].concat(g(S(0,h-1)),g(S(h+1,a-1))),l=0;l<e;++l){var _=m(i.choice(c,2),2),f=_[0],v=_[1],d=Math.exp(-Math.pow(n(t.row(h),t.row(f)),2)/(r[h]*r[f]));d<1e-20&&(d=1e-20);var p=Math.exp(-Math.pow(n(t.row(h),t.row(v)),2)/(r[h]*r[v]));if(p<1e-20&&(p=1e-20),d<p){var y=[v,f];f=y[0],v=y[1];var w=[p,d];d=w[0],p=w[1]}var k=u+l;o.set_entry(k,0,h),o.set_entry(k,1,f),o.set_entry(k,2,v),s[k]=d/p}return{random_triplets:o,random_weights:s}}},{key:"_grad",value:function(t){for(var e=this.n_inliers,r=this.n_outliers,n=this.triplets,i=this.weights,a=m(t.shape,2),o=a[0],s=a[1],h=n.shape[0],u=new N(o,s,0),c=new Array(s).fill(0),l=new Array(s).fill(0),_=1,f=1,v=0,d=0,p=o*e*r,y=0;y<h;++y){var g=m(n.row(y),3),w=g[0],k=g[1],b=g[2];if(y%r==0||y>=p){_=1,f=1;for(var x=0;x<s;++x){var M=t.entry(w,x),A=t.entry(k,x),j=t.entry(b,x);c[x]=M-A,l[x]=M-j,_+=Math.pow(c[x],2),f+=Math.pow(l[x],2)}}else{f=1;for(var z=0;z<s;++z){var R=t.entry(w,z),S=t.entry(b,z);l[z]=R-S,f+=Math.pow(l[z],2)}}_>f&&++v,d+=i[y]/(1+f/_);for(var E=Math.pow(i[y]/(_+f),2),O=0;O<s;++O){var X=c[O]*f*E,P=l[O]*_*E;u.set_entry(w,O,u.entry(w,O)+X-P),u.set_entry(k,O,u.entry(k,O)-X),u.set_entry(b,O,u.entry(b,O)+P)}}return{grad:u,loss:d,n_viol:v}}},{key:"transform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:400;this.check_init();for(var e=0;e<t;++e)this._next(e);return this.projection}},{key:"generator",value:regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.check_init(),e=0;case 2:if(!(e<800)){t.next=9;break}return this._next(e),t.next=6,this.projection;case 6:++e,t.next=2;break;case 9:return t.abrupt("return",this.projection);case 10:case"end":return t.stop()}}),t,this)}))},{key:"_next",value:function(t){var e=t>150?.5:.3,r=this.C,n=this.vel,i=this.Y.add(n.mult(e)),a=this._grad(i),o=a.grad,s=a.loss;return a.n_viol,this.C=s,this.Y=this._update_embedding(i,t,o),this.lr*=r>s+this.tol?1.01:.9,this.Y}},{key:"_update_embedding",value:function(t,e,r){for(var n=m(t.shape,2),i=n[0],a=n[1],o=e>150?.9:.5,s=this.gain,h=this.vel,u=this.lr,c=0;c<i;++c)for(var l=0;l<a;++l){var _=Math.sign(h.entry(c,l))!=Math.sign(r.entry(c,l))?s.entry(c,l)+.2:Math.max(.8*s.entry(c,l),.01);s.set_entry(c,l,_),h.set_entry(c,l,o*h.entry(c,l)-u*s.entry(c,l)*r.entry(c,l)),t.set_entry(c,l,t.entry(c,l)+h.entry(c,l))}return t}}]),r}(L),$=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"single",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x;return a(this,t),this._id=0,this._matrix=e,this._metric=n,this._linkage=r,this.init(),this.root=this.do(),this}return s(t,[{key:"get_clusters",value:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"distance",n=[];switch(r){case"distance":e=function(t){return t.dist};break;case"depth":e=function(t){return t.depth};break;default:throw"invalid type"}return this._traverse(this.root,e,t,n),n}},{key:"_traverse",value:function(t,e,r,n){e(t)<=r?n.push(t.leaves()):(this._traverse(t.left,e,r,n),this._traverse(t.right,e,r,n))}},{key:"init",value:function(){for(var t=this._metric,e=this._matrix,r=this._n=e.shape[0],n=this._d_min=new Float64Array(r),i=this._distance_matrix=new Array(r),a=0;a<r;++a){n[a]=0,i[a]=new Float64Array(r);for(var o=0;o<r;++o)i[a][o]=a===o?1/0:t(e.row(a),e.row(o)),i[a][n[a]]>i[a][o]&&(n[a]=o)}for(var s=this._clusters=new Array(r),h=this._c_size=new Uint16Array(r),u=0;u<r;++u)s[u]=[],s[u][0]=new J(this._id++,null,null,0,e.row(u),u,1,0),h[u]=1;return this}},{key:"do",value:function(){for(var t=this._n,e=this._d_min,r=this._distance_matrix,n=this._clusters,i=this._c_size,a=this._linkage,o=null,s=0,h=t-1;s<h;++s){for(var u=0,c=0;c<t;++c)r[c][e[c]]<r[u][e[u]]&&(u=c);var l=e[u],_=n[u][0],f=n[l][0],v=new J(this._id++,_,f,r[u][l]);n[u].unshift(v),i[u]+=i[l];for(var d=0;d<t;++d)switch(a){case"single":r[u][d]>r[l][d]&&(r[d][u]=r[u][d]=r[l][d]);break;case"complete":r[u][d]<r[l][d]&&(r[d][u]=r[u][d]=r[l][d]);break;case"average":r[d][u]=r[u][d]=(i[u]*r[u][d]+i[l]*r[l][d])/(i[u]+i[d])}r[u][u]=1/0;for(var p=0;p<t;++p)r[p][l]=r[l][p]=1/0;for(var y=0;y<t;++y)e[y]===l&&(e[y]=u),r[u][y]<r[u][e[u]]&&(e[u]=y);o=v}return o}}]),t}(),J=function(){function t(e,r,n,i,o,s,h,u){return a(this,t),this.id=e,this.left=r,this.right=n,this.dist=i,this.index=s,this.size=null!=h?h:r.size+n.size,this.depth=null!=u?u:1+Math.max(r.depth,n.depth),this.centroid=null!=o?o:this._calculate_centroid(r,n),this}return s(t,[{key:"_calculate_centroid",value:function(t,e){for(var r=t.size,n=e.size,i=t.centroid,a=e.centroid,o=this.size,s=t.centroid.length,h=new Float64Array(s),u=0;u<s;++u)h[u]=(r*i[u]+n*a[u])/o;return h}},{key:"isLeaf",get:function(){return 0===this.depth}},{key:"leaves",value:function(){if(this.isLeaf)return[this.index];var t=this.left,e=this.right;return(t.isLeaf?[t.index]:t.leaves()).concat(e.isLeaf?[e.index]:e.leaves())}}]),t}(),Z=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1987,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];a(this,t),this._metric=n,this._matrix=e,this._K=r;var s=m(e.shape,2),h=s[0],u=s[1];return this._N=h,this._D=u,r>h&&(r=h),this._randomizer=new O(i),this._clusters=new Array(h).fill(void 0),this._cluster_centroids=this._get_random_centroids(r),o&&this.init(r,this._cluster_centroids),this}return s(t,[{key:"get_clusters",value:function(){var t=this._K,e=this._clusters,r=new Array(t).fill().map((function(){return new Array}));return e.forEach((function(t,e){return r[t].push(e)})),r}},{key:"_furthest_point",value:function(t,e){var r=this._matrix,n=this._metric,i=t.length;return Y.heapify(e,(function(e){for(var a=r.row(e),o=0,s=0;s<i;++s)o+=n(a,t[s]);return o}),"max").pop().element}},{key:"_get_random_centroids",value:function(t){var e=this._N,r=this._randomizer,n=this._matrix,i=new Array(t).fill(),a=S(0,e-1),o=r.random_int%(e-1);i[0]=n.row(o);for(var s=[o],h=Math.floor((e-t)/t),u=1;u<t;++u){var c=r.choice(a.filter((function(t){return-1==s.indexOf(t)})),h),l=this._furthest_point(i.slice(0,u),c);s.push(l),i[u]=n.row(l)}return i}},{key:"_iteration",value:function(t){for(var e=t.length,r=this._N,n=this._D,i=this._matrix,a=this._metric,o=this._clusters,s=!1,h=0;h<r;++h){for(var u=i.row(h),c=1/0,l=null,_=0;_<e;++_){var f=a(t[_],u);f<c&&(c=f,l=_)}o[h]!==l&&(s=!0),o[h]=l}for(var v=0;v<e;++v)for(var d=t[v],p=0;p<n;++p)d[p]=0;return this._compute_centroid(t),{clusters_changed:s,cluster_centroids:t}}},{key:"_compute_centroid",value:function(t){for(var e=t.length,r=this._N,n=this._D,i=this._matrix,a=this._clusters,o=new Array(e).fill(0),s=0;s<r;++s){var h=i.row(s),u=a[s];o[u]++;for(var c=t[u],l=0;l<n;++l)c[l]+=h[l]}for(var _=function(e){var r=o[e];t[e]=t[e].map((function(t){return t/r}))},f=0;f<e;++f)_(f)}},{key:"init",value:function(t,e){t||(t=this._K),e||(e=this._get_random_centroids(t));var r=!1;do{var n=this._iteration(e);e=n.cluster_centroids,r=n.clusters_changed}while(r)}}]),t}(),tt=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1212;a(this,t),this._metric=i,this._matrix=e,this._A=this._matrix.to2dArray,this._K=r;var s=m(e.shape,2),h=s[0],u=s[1];return this._N=h,this._D=u,this._max_iter=n||10*Math.log10(h),this._distance_matrix=new N(h,h,"zeros"),r>h&&(r=h),this._randomizer=new O(o),this._clusters=new Array(h).fill(void 0),this._cluster_medoids=this._get_random_medoids(r),this._is_initialized=!1,this}return s(t,[{key:"get_clusters",value:function(){var t=this,e=this._K,r=this._A;this._is_initialized||this.init(e,this._cluster_medoids);var n=new Array(e).fill().map((function(){return new Array}));return r.forEach((function(e,r){n[t._nearest_medoid(e,r).index_nearest].push(r)})),n.medoids=this._cluster_medoids,n}},{key:"generator",value:function(){var t,e=this;return(t=regeneratorRuntime.mark((function t(){var r,n,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e._max_iter,t.next=3,e.get_clusters();case 3:n=!1,i=0;case 5:return n=e._iteration(),t.next=8,e.get_clusters();case 8:if(!n&&++i<r){t.next=5;break}case 9:case"end":return t.stop()}}),t)})),function(){return new r(t.apply(this,arguments))})()}},{key:"_iteration",value:function(){var t=this,e=this._A,r=this._K,n=this._cluster_medoids,i=e.map((function(e,r){return t._nearest_medoid(e,r)})),a=new Array(r).fill(0),o=new Array(r).fill(null);if(e.forEach((function(s,h){if(n.findIndex((function(t){return t===h}))<0){var u=i[h].distance_nearest,c=new Array(r).fill(-u);e.forEach((function(e,n){if(h!==n){var a=t._get_distance(n,h,e,s),o=i[n],u=o.index_nearest,l=o.distance_nearest,_=o.distance_second;if(c[u]+=Math.min(a,_)-l,a<l)for(var f=0;f<r;++f)f!==u&&(c[f]+=a-l)}})),c.map((function(t,e){return[t,e]})).filter((function(t){var e=m(t,2),r=e[0],n=e[1];return r<a[n]})).forEach((function(t){var e=m(t,2),r=e[0],n=e[1];r<a[n]&&(a[n]=r,o[n]=h)}))}})),Math.min.apply(Math,g(a))>=0)return!0;for(var s=function(){var r=a.map((function(t,e){return[t,e]})).sort((function(t,e){return m(t,1)[0]-m(e,1)[0]}))[0][1];0==n.filter((function(t){return t==o[r]})).length&&(n[r]=o[r]),a[r]=0,a.map((function(t,e){return[t,e]})).filter((function(t){return m(t,1)[0]<0})).forEach((function(o){var s=m(o,2);s[0];var h=s[1],u=e[h],c=0;e.forEach((function(e,a){n.findIndex((function(t){return t!=h&&t==a}))>=0||r!=h&&(i[a].index_nearest===n[h]?c+=Math.min(t._get_distance(a,h,e,u),i[a].distance_second)-i[a].distance_nearest:c+=Math.min(t._get_distance(a,h,e,u)-i[a].distance_nearest,0))})),a[h]=c}))};Math.min.apply(Math,g(a))<0;)s();return this._cluster_medoids=n,!1}},{key:"_get_distance",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t===e)return 0;var i=this._distance_matrix,a=this._A,o=this._metric,s=i.entry(t,e);return 0===s&&(s=o(r||a[t],n||a[e]),i.set_entry(t,e,s),i.set_entry(e,t,s)),s}},{key:"_nearest_medoid",value:function(t,e){var r=this,n=this._cluster_medoids,i=this._A,a=m(n.map((function(n,a){var o=i[n];return[r._get_distance(e,n,t,o),a]})).sort((function(t,e){return t[0]-e[0]})),2),o=a[0],s=a[1];return{distance_nearest:o[0],index_nearest:o[1],distance_second:s[0],index_second:s[1]}}},{key:"init",value:function(t,e){t||(t=this._K),e||(e=this._get_random_medoids(t));var r=this._max_iter,n=!1,i=0;do{n=this._iteration()}while(!n&&++i<r);return this}},{key:"_get_random_medoids",value:function(t){for(var e=this,r=this._N,n=this._A,i=S(0,r-1),a=this._randomizer,o=Math.min(r,10+Math.ceil(Math.sqrt(r))),s=new Array(o).fill(1/0),h=[],u=1/0,c=a.choice(i,o),l=0;l<o;++l){for(var _=c[l],f=n[_],v=0;v<o;++v)if(v!==l){var d=n[c[v]];s[l]+=this._get_distance(l,v,f,d)}s[l]<u&&(u=s[l],h.push(_))}for(var p=1;p<t;++p){var y=1/0;c=a.choice(i.filter((function(t){return h.findIndex((function(e){return e===t}))<0})),o);for(var m=0;m<o;++m){for(var w=0,k=c[m],b=n[k],x=function(t){if(t===m)return"continue";var r=c[t],i=n[r],a=e._get_distance(k,r,b,i)-Math.min.apply(Math,g(h.map((function(t){return e._get_distance(r,t,i)}))));a<0&&(w+=a)},M=0;M<o;++M)x(M);w<y&&(y=w,h.push(k))}u+=y}return h.slice(0,t)}}]),t}(),et=function(){function t(e,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x;return a(this,t),this._matrix=e,this._epsilon=r,this._min_points=n,this._metric=i,this._ordered_list=[],this._clusters=[],this._DB=new Array(e.shape[0]).fill(),this.init(),this}return s(t,[{key:"init",value:function(){for(var t=this._ordered_list,e=this._matrix,r=e.shape[0],n=this._DB,i=this._clusters,a=this._cluster_index=0,o=0;o<r;++o)n[o]={element:e.row(o),index:o,reachability_distance:void 0,processed:!1};var s,h=b(n);try{for(h.s();!(s=h.n()).done;){var u=s.value;if(!u.processed&&(u.neighbors=this._get_neighbors(u),u.processed=!0,i.push([u.index]),a=i.length-1,t.push(u),null!=this._core_distance(u))){var c=new Y(null,(function(t){return t.reachability_distance}),"min");this._update(u,c),this._expand_cluster(c,i[a])}}}catch(t){h.e(t)}finally{h.f()}return this}},{key:"_get_neighbors",value:function(t){if("neighbors"in t)return t.neighbors;var e,r=this._DB,n=this._metric,i=this._epsilon,a=[],o=b(r);try{for(o.s();!(e=o.n()).done;){var s=e.value;s.index!=t.index&&(n(t.element,s.element)<i&&a.push(s))}}catch(t){o.e(t)}finally{o.f()}return a}},{key:"_core_distance",value:function(t){var e=this._min_points,r=this._metric;if(!(t.neighbors&&t.neighbors.length<=e))return r(t.element,t.neighbors[e].element)}},{key:"_update",value:function(t,e){var r,n=this._metric,i=this._core_distance(t),a=b(this._get_neighbors(t));try{var o=function(){var a=r.value;if(a.processed)return"continue";var o=Math.max(i,n(t.element,a.element));e.raw_data().findIndex((function(t){return t.element==a}))<0?(a.reachability_distance=o,e.push(a)):o<a.reachability_distance&&(a.reachability_distance=o,e=Y.heapify(e.data(),(function(t){return t.reachability_distance}),"min"))};for(a.s();!(r=a.n()).done;)o()}catch(t){a.e(t)}finally{a.f()}}},{key:"_expand_cluster",value:function(t,e){for(var r=this._ordered_list;!t.empty;){var n=t.pop().element;n.neighbors=this._get_neighbors(n),n.processed=!0,e.push(n.index),r.push(n),null!=this._core_distance(n)&&(this._update(n,t),this._expand_cluster(t,e))}}},{key:"get_clusters",value:function(){var t,e=[],r=[],n=this._min_points,i=b(this._clusters);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.length<n?r.push.apply(r,g(a)):e.push(a)}}catch(t){i.e(t)}finally{i.f()}return e.push(r),e}},{key:"get_cluster_affirmation",value:function(){for(var t=this._matrix.shape[0],e=new Array(t).fill(),r=this.get_clusters(),n=0,i=r.length;n<i;++n){var a,o=b(r[n]);try{for(o.s();!(a=o.n()).done;){e[a.value]=n<i-1?n:-1}}catch(t){o.e(t)}finally{o.f()}}return e}}]),t}(),rt=function(t){h(r,t);var e=d(r);function r(t,n,i){var o,s,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:x,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1212;return a(this,r),y((o=f(s=e.call(this,t,h,c,l)),u(r.prototype)),"parameter_list",["k","control_points"],o,!0),s.parameter("k",Math.min(null!=n?n:Math.max(Math.floor(s._N/10),2),s._N-1)),s.parameter("control_points",Math.min(null!=i?i:Math.ceil(Math.sqrt(s._N)),s._N-1)),s._is_initialized=!1,v(s,f(s))}return s(r,[{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T;if(this._is_initialized)return this;var n=this.X,i=this._N,a=this.parameter("k"),o=this._d,s=this._metric,h=this.parameter("control_points"),u=new tt(n,h,null,s).get_clusters().medoids,c=new N(h,i,"zeros");u.forEach((function(t,e){c.set_entry(e,t,1)}));var l=_(t,[N.from(u.map((function(t){return n.row(t)})))].concat(g(e),[o])).transform(),f=n.to2dArray,v=new r(f,s),d=new N(i,i,"I"),p=-1/a;f.forEach((function(t,e){var r,n=b(v.search(t,a).iterate());try{for(n.s();!(r=n.n()).done;){var i=r.value.index;e!==i&&d.set_entry(e,i,p)}}catch(t){n.e(t)}finally{n.f()}}));var y=d.concat(c,"vertical"),m=new N(i,o,"zeros"),w=m.concat(l,"vertical");return this._A=y,this._b=w,this._is_initialized=!0,this}},{key:"transform",value:function(){this.check_init();var t=this._A,e=t.T,r=this._b,n=e.dot(t),i=e.dot(r);return this.Y=N.solve_CG(n,i,this._randomizer),this.projection}}]),r}(L),nt=function(t){h(r,t);var e=d(r);function r(t){var n,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1212;a(this,r),(i=e.call(this,t,o,s,h)).__align_components=function(t,e,r){var n=g(t.__disjoint_set.children),a=g(e.__disjoint_set.children),o=i.__hull(n),s=i.__hull(a),h=i.__align_hull(o,t,!1),u=i.__align_hull(s,e,!0);i.__transform_component(n,h,0),i.__transform_component(a,u,r)},y((n=f(i),u(r.prototype)),"parameter_list",[],n,!0);var c=m(i.X.shape,2);return i._N=c[0],i._D=c[1],i._distance_matrix=new N(i._N,i._N,0),v(i,f(i))}return s(r,[{key:"__lazy_distance_matrix",value:function(t,e,r){var n=this._distance_matrix,i=this.X,a=n.entry(t,e);if(0===a){var o=r(i.row(t),i.row(e));return n.set_entry(t,e,o),n.set_entry(e,t,o),o}return a}},{key:"_make_minimum_spanning_tree",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,e=this._N,r=g(this.X),n=new it(r),i=[],a=[],o=0;o<e;++o)for(var s=o+1;s<e;++s)a.push([o,s,this.__lazy_distance_matrix(o,s,t)]);var h,u=b(a=a.sort((function(t,e){return t[2]-e[2]})));try{for(u.s();!(h=u.n()).done;){var c=m(h.value,3),l=c[0],_=c[1],f=c[2],v=n.find(r[l]),d=n.find(r[_]);v!==d&&(i.push([l,_,f]),n.union(v,d))}}catch(t){u.e(t)}finally{u.f()}return i.sort((function(t,e){return t[2]-e[2]}))}},{key:"init",value:function(){return this.Y=new N(this._N,this._d,0),this._Emst=this._make_minimum_spanning_tree(this._metric),this._is_initialized=!0,this}},{key:"__hull_cross",value:function(t,e,r){var n=m(t,2),i=n[0],a=n[1],o=m(e,2),s=o[0],h=o[1],u=m(r,2),c=u[0];return(s-i)*(u[1]-a)-(h-a)*(c-i)<=0}},{key:"__hull",value:function(t){var e=t.sort((function(t,e){var r=m(t,2),n=r[0],i=r[1],a=m(e,2),o=a[0];return i-a[1]||n-o})),r=e.length;if(r<=2)return e;for(var n=[],i=0;i<r;++i){for(;n.length>=2&&this.__hull_cross(n[n.length-2],n[n.length-1],e[i]);)n.pop();n.push(e[i])}for(var a=[],o=r-1;o>=0;--o){for(;a.length>=2&&this.__hull_cross(a[a.length-2],a[a.length-1],e[o]);)a.pop();a.push(e[o])}return a.pop(),n.pop(),n.concat(a)}},{key:"__findAngle",value:function(t,e){var r=m(t,2),n=r[0],i=r[1],a=m(e,2),o=a[0],s=a[1],h=x([n,i],[o,s]);if(0===h)return{sin:0,cos:1};var u=[(o-n)/h,(s-i)/h],c=u[0],l=Math.sqrt(1-c*c);return{sin:l=u[1]>=0?-l:l,cos:c}}},{key:"__align_hull",value:function(t,e,r){for(var n,i,a,o=-1,s=0;s<t.length;++s){var h=x(t[s],e);(-1===o||n>h)&&(n=h,o=s)}r?(i=t[o],a=t[(o+1)%t.length]):(0==o&&(o=t.length-1),i=t[o],a=t[(o-1)%t.length]);var u={tx:-t[o][0],ty:-t[o][1]};if(t.length>=2){var c=this.__findAngle(i,a),l=c.sin,_=c.cos;u.sin=l,u.cos=_}else u.sin=0,u.cos=1;return u}},{key:"__transform",value:function(t,e){var r=m(t,2),n=r[0],i=r[1],a=e.tx,o=e.ty,s=e.sin,h=e.cos,u=n+a,c=i+o;return[u*h-c*s,u*s+c*h]}},{key:"__transform_component",value:function(t,e,r){for(var n=t.length,i=0;i<n;++i){var a=t[i],o=m(this.__transform(a,e),2),s=o[0],h=o[1];a[0]=s,a[1]=h+r}}},{key:"transform",value:function(){this._is_initialized||this.init();var t,e=this._Emst,r=g(this.Y),n=new it(r.map((function(t,e){return t.i=e,t}))),i=b(e);try{for(i.s();!(t=i.n()).done;){var a=m(t.value,3),o=a[0],s=a[1],h=a[2],u=n.find(r[o]),c=n.find(r[s]);u!==c&&(this.__align_components(u,c,h),n.union(u,c))}}catch(t){i.e(t)}finally{i.f()}return this.projection}},{key:"generator",value:regeneratorRuntime.mark((function t(){var e,r,n,i,a,o,s,h,u,c,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._is_initialized||this.init(),e=this._Emst,r=g(this.Y),n=new it(r.map((function(t,e){return t.i=e,t}))),i=b(e),t.prev=5,i.s();case 7:if((a=i.n()).done){t.next=19;break}if(o=m(a.value,3),s=o[0],h=o[1],u=o[2],c=n.find(r[s]),l=n.find(r[h]),c!==l){t.next=13;break}return t.abrupt("continue",17);case 13:return this.__align_components(c,l,u),n.union(c,l),t.next=17,this.projection;case 17:t.next=7;break;case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(5),i.e(t.t0);case 24:return t.prev=24,i.f(),t.finish(24);case 27:return t.abrupt("return",this.projection);case 28:case"end":return t.stop()}}),t,this,[[5,21,24,27]])}))}]),r}(L),it=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(a(this,t),this._list=new Set,e){var r,n=b(e);try{for(n.s();!(r=n.n()).done;){var i=r.value;this.make_set(i)}}catch(t){n.e(t)}finally{n.f()}}return this}return s(t,[{key:"make_set",value:function(t){var e=this._list;return e.has(t)||(e.add(t),t.__disjoint_set={},t.__disjoint_set.parent=t,t.__disjoint_set.children=new Set([t]),t.__disjoint_set.size=1),this}},{key:"find",value:function(t){var e;return this._list.has(t)?t.__disjoint_set.parent!==t?((e=t.__disjoint_set.children).add.apply(e,g(t)),t.__disjoint_set.parent=this.find(t.__disjoint_set.parent),t.__disjoint_set.parent):t:null}},{key:"union",value:function(t,e){var r=this.find(t),n=this.find(e);if(r===n)return this;if(r.__disjoint_set.size<n.__disjoint_set.size){var i=[n,r];r=i[0],n=i[1]}return n.__disjoint_set.parent=r,n.__disjoint_set.children.forEach(r.__disjoint_set.children.add,r.__disjoint_set.children),r.__disjoint_set.size+=n.__disjoint_set.size,this}}]),t}(),at=function(t){h(r,t);var e=d(r);function r(t){var n,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1212;a(this,r),y((n=f(i=e.call(this,t,s,h,c)),u(r.prototype)),"parameter_list",["max_halves"],n,!0),i.parameter("max_halves",o);var l=m(i.X.shape,2);return i._N=l[0],i._D=l[1],v(i,f(i))}return s(r,[{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"random",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this._N,n=this._d;if("random"===t){var i=this._randomizer;console.log(i),this.Y=new N(r,n,(function(){return i.random}))}else this.Y=t.transform(this.X);var a=this.Y;e||(e=new N(r,r));for(var o=this._metric,s=new N(r,r),h=new N(r,r),u=0;u<r;++u)for(var c=a.row(u),l=u;l<r;++l){var _=u===l?1:o(c,a.row(l)),f=1/_;if(s.set_entry(u,l,_),s.set_entry(l,u,_),h.set_entry(u,l,f),h.set_entry(l,u,f),!e){var v=u===l?1:o(X.row(u),X.row(l));e.set_entry(u,l,v),e.set_entry(l,u,v)}}var d=e._apply(1,(function(t,e){return e/t})),p=e.sub(s),y=p._apply(2,(function(t,e){return Math.pow(t,e)})).mult(d);return console.log(y),this._distance_matrix=s,this._distance_inverse_matrix=h,this._Distance_matrix=e,this._Distance_inverse_matrix=h,this._delta=p,this._ones=new N(r,n,1),this._E=y.sum,this}},{key:"__distance_matrix",value:function(t){for(var e=this._metric,r=t.shape[0],n=new N(r,r),i=0;i<r;++i)for(var a=t.row(i),o=i;o<r;++o){var s=i===o?1:e(a,t.row(o));n.set_entry(i,o,s),n.set_entry(o,i,s)}return n}},{key:"transform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;this._is_initialized||this.init();for(var e=0;e<t;++e)console.log(g(this.Y)),this._step();return this.projection}},{key:"generator",value:regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._is_initialized||this.init(),e=0;case 2:if(!(e<max_iter)){t.next=9;break}return this._step(),t.next=6,this.projection;case 6:++e,t.next=2;break;case 9:return t.abrupt("return",this.projection);case 10:case"end":return t.stop()}}),t,this)}))},{key:"_step",value:function(){var t=this.parameter("max_halves"),e=this._distance_matrix,r=this._distance_inverse_matrix,n=this._Distance_matrix,i=this._Distance_inverse_matrix,a=this._ones,o=this._E,s=this.Y,h=r.sub(i),u=h.dot(a),c=h.dot(s).sub(s.mult(u)),l=r._apply(3,(function(t,e){return Math.pow(t,e)})),_=s._apply(2,(function(t,e){return Math.pow(t,e)})),f=l.dot(_).sub(u).sub(s.mult(2).mult(l.dot(s))).add(_.mult(l.dot(a)));f=f._apply(null,(function(t){return Math.abs(t)}));for(var v=c.divide(f),d=s.clone(),p=0;p<t;++p){if(s=d.add(v),r=(e=this.__distance_matrix(s))._apply(1,(function(t,e){return e/t})),(h=n.sub(e))._apply(2,(function(t,e){return Math.pow(t,e)})).mult(i).sum<o)break;v=v.mult(.5)}this.Y=s}}]),r}(L);t.BallTree=T,t.FASTMAP=q,t.Heap=Y,t.Hierarchical_Clustering=$,t.ISOMAP=K,t.KMeans=Z,t.KMedoids=tt,t.LDA=C,t.LLE=U,t.LSP=rt,t.LTSA=W,t.MDS=B,t.Matrix=N,t.OPTICS=et,t.PCA=I,t.Randomizer=O,t.SAMMON=at,t.TSNE=G,t.TopoMap=nt,t.TriMap=V,t.UMAP=H,t.canberra=function(t,e){if(t.length===e.length){for(var r=t.length,n=0,i=0;i<r;++i)n+=Math.abs(t[i]-e[i])/(Math.abs(t[i])+Math.abs(e[i]));return n}},t.chebyshev=function(t,e){if(t.length==e.length){for(var r=t.length,n=[],i=0;i<r;++i)n.push(Math.abs(t[i]-e[i]));return Math.max.apply(Math,n)}},t.cosine=function(t,e){if(t.length===e.length){for(var r=t.length,n=0,i=0,a=0,o=0;o<r;++o)n+=t[o]*e[o],i+=t[o]*t[o],a+=e[o]*e[o];return Math.acos(n/(Math.sqrt(i)*Math.sqrt(a)))}},t.distance_matrix=R,t.euclidean=x,t.euclidean_squared=A,t.k_nearest_neighbors=j,t.kahan_sum=function(t){for(var e,r,n=t.length,i=0,a=0,o=0;o<n;++o)a=(r=i+(e=t[o]-a))-i-e,i=r;return i},t.linspace=S,t.manhattan=function(t,e){if(t.length==e.length){for(var r=t.length,n=0,i=0;i<r;++i)n+=Math.abs(t[i]-e[i]);return n}},t.max=P,t.neumair_sum=M,t.norm=E,t.powell=Q,t.qr=F,t.simultaneous_poweriteration=D,t.version="0.3.9",Object.defineProperty(t,"__esModule",{value:!0})}));
